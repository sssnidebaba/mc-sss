# 我的世界项目-冼俊轩 #
*******
## 1、项目名称――《我的世界》 ##
***********
## 2、课题背景或简介 ##

*《我的世界》是一款开放世界游戏，玩家没有具体要完成的目标，并且在游戏内有极高的自由度。
其核心玩法是不断的破坏与放置，以此来创造出玩家想要的独特世界。游戏世界由许多方块组成。
该课题作为4399在PCG（程序化生成）、UGC（用户生成内容）方面的探索，通过该课题解决该品类游戏的技术障碍，为后续开发类似游戏demo，作为一款产品的起点而奠基。

*使用Unity3D，实现类似我的世界的游戏。

*做了地图随机生成以及无限地图生成。

*采用了柏林噪声用于生成地形。

*随机生成草地，沙子，泥土，石块，煤炭和树木。

*角色视角切换和界面UI。

*昼夜交替和天气系统。

*优化地图生成逻辑，使地形更自然。

*加入水下物理逻辑与水下滤镜

*添加聊天系统，可以使用聊天系统查看记录与输入系统指令

*使用系统指令可以完成传送，查看天气，设置天气等操作

***********
## 3、成果或演示的截图 ##

*游戏开始页面：
![开始界面](/screenshot/start1.PNG)

*进入游戏后会先在高处出生点等待地形生成：
![游戏截图1](/screenshot/jietu1.PNG)

*游戏内地形使用了Lib柏林噪声生成，地形随机性较好，会形成天然空洞：
![游戏截图2](/screenshot/jietu2.PNG)

*游戏内地形动态生成，随角色走动会生成新地图：
![游戏截图3](/screenshot/jietu3.PNG)

*游戏内物体可以破坏与建造，能够通过鼠标滑轮或输入数字改变创建的方块类型：
![游戏截图4](/screenshot/jietu4.PNG)

*游戏内地形生成具有逻辑，水地形附近会生成沙子，水底不会生成树木与草地：
![游戏截图5](/screenshot/jietu5.PNG)

*游戏内进入水下后会有水下滤镜效果，同时能够有较低的重力以及可以无限跳跃，通过不停跳跃实现水面游泳：
![游戏截图6](/screenshot/jietu6.PNG)

*游戏内点击回车键会出现聊天窗口与选项，点击ESC键会退出该窗口：
![游戏截图7](/screenshot/jietu7.PNG)

*聊天窗口会记录在输入栏输入的字符，可以上下拖动滚动条查看聊天记录：
![游戏截图8](/screenshot/jietu8.PNG)

*聊天窗口可以输入特殊指令来实现传送操作：
![游戏截图9-1](/screenshot/jietu9-1.PNG)
![游戏截图9-2](/screenshot/jietu9-2.PNG)
![游戏截图9-3](/screenshot/jietu9-3.PNG)

*可以通过输入特殊指令清除聊天记录：
![游戏截图10](/screenshot/jietu10.PNG)

*游戏内天气系统与聊天窗口有一定联动，可以通过聊天窗口查看当前天气：
![游戏截图11-1](/screenshot/jietu11-1.PNG)
![游戏截图11-2](/screenshot/jietu11-2.PNG)

*还可以通过聊天窗口改变当前天气：
![游戏截图11-3](/screenshot/jietu11-3.PNG)
![游戏截图11-4](/screenshot/jietu11-4.PNG)
![游戏截图11-5](/screenshot/jietu11-5.PNG)
![游戏截图11-6](/screenshot/jietu11-6.PNG)
![游戏截图11-7](/screenshot/jietu11-7.PNG)

***********
## 4、项目工程使用的技术、工具和软件版本##

*项目工程使用Unity 2021.2.14版本 。

*使用了Camera Filter Pack滤镜组构建水下滤镜。

*使用了LibNoise柏林噪声函数生成地图。

*使用并魔改了Unity官方的第一人称视角预制件。

*使用DCG Water Shaders制作水面。

*使用UniStorm制作昼夜系统与天气系统。


***********
## 5、演示或使用方法 ##

###玩家视角###

*演示见上演示截图。

*WASD控制角色移动方向，鼠标拖动可以调整角色视角，Q切换一三人称视角。

*鼠标左键点击摧毁方块，鼠标右键创建方块，操作半径设置为10（可设置）。
目前游戏内置七种可放置方块，可以通过添BlockList脚本添加新的方块或者删除方块。

*角色出生在高度60的出生点，地图高度限制设定为52。
游戏刚开始需要在出生点等待地图生成，角色无法在出生点放置与摧毁方块，避免出错。

*地图由许多Chunk组成，一个Chunk设定长16，宽16，高52。
地图动态生成，检测到角色附近10（可设置）个Chunk的范围，如果有还未生成的Chunk会自动生成地图。

*角色在水中重力减小，有特殊水下滤镜（通过调整镜头模糊，RGB和亮度实现）。
角色在水中可以无限跳跃，按住空格键可以实现在水面上游泳。

*游戏内白天晚上各五分钟，天气每天变化一次。
游戏内目前一个内置八种天气随机出现（Clear,Mostly_Clear,Rain,Heavy_Rain,Snow,Heavy_Snow,Cloudy,Thunderstorm)

*按回车键能够呼出聊天界面，聊天界面侧边有按钮可以使用，目前存档功能我尚未实现（有组内其他成员完成）

*按ESC键可以退出聊天窗口。

*聊天界面可以记录输入栏的内容，有滚动条可以拖动，退出聊天系统后不会清空记录，再次进入可以看到内容。
通过输入指令“/clear”可以清空记录。

*可以使用聊天窗口进行传送，输入指令“/tp”，窗口会提示输入目的地，可以选择输入三维坐标或者回家指令"/home"。
输入回家指令可以传送回家（默认设置为出生点），输入坐标则会传送至指定坐标，还做了对坐标的检测，输入不规范坐标或者错误指令会提示传送失败。

*可以使用聊天窗口可以设置一些其他内容，输入指令"/sethome"能够将家设置在当前坐标。
输入指令"/position"可以查看角色当前坐标。
输入指令"/setname"可以改变用户名（默认名为4399_xjx）。

*可以使用聊天窗口调节天气。输入指令"showWeather"可以查看当前天气。

*输入指令"changeWeather"可以改变当前天气，系统会提示输入要改变的天气。
目前只能输入内置的八种天气（Clear,MostlyClear,Rain,HeavyRain,Snow,HeavySnow,Cloudy,Thunderstorm），
对应天气指令为（"/clear","/mostlyClear","/rain","/heavyRain","/snow",/"heavySnow","/cloudy","/thunderstorm"）。
输入其他内容会提示错误。

###开发者视角###

*工程文件使用Unity 2021.2.14打开项目文件即可运行。

####地图与方块部分####

*对方块来说，每个方块都是通过绘制面生成的，只绘制能够看到的面，而不绘制看不到的面。
这样能够很大程度降低CPU的消耗。

*在/Assets/Map/Scripts/Block目录下存放了关于Bolck方块的脚本。
每个Block有id，name和六个面的贴图，该脚本下存放了定义Block的方法。

*在/Assets/Map/Scripts/Block目录下存放了关于BolckList脚本。
在BlockList脚本的Awake（）函数下会设置方块的种类，目前内置一共七种，可以在这里添加方块种类。
方块贴图存放在/Assets/Map/Image下。

*在/Assets/Map/Scripts目录下的Game Manager会调用当前时间戳作为随机数种子。

*在/Assets/Map/Scripts/World目录下的Terrain脚本会使用Game Manager生成的随机数种子（可以在这里加入随机数种子的指定）。
该脚本下会使用LibNoise柏林噪声来进行地图生成，通过对noiseValue的取值来实现地图的初步生成。

*在/Assets/Map/Scripts/World目录下的Map脚本可以用于获取Chunk对象，以及用于判断Chunk是否存在，用于启动地图生成。

*在/Assets/Map/Scripts/World目录下的Chunk脚本用于对地图生成逻辑的优化与实现地图破坏。
Chunk脚本会对Terrain脚本初步生成的地形进行修改，通过控制逻辑来实现为地图随机生成草地，树木，沙子，煤炭等物品。
会将bolck的id存放在数组中，未渲染出来的方块不是不存在，只是它们是以数组中的blockid形式存在的。
通过改变数组中指定位置的blockid，再对该Chunk进行绘制，就能实现对方块的改变，由此实现方块的破坏与创建。
（空气方块的blockid默认为0，可以将对应位置的blockid改成0来实现破坏，在原本blockid为0的地方存放新的id实现创造。）

*在/Assets/Map/Scripts/Player目录下的PlayerController脚本用于控制地图动态生成。
可以调整变量viewRange来设置预先生成的Chunk数量。

*在/Assets/Map/Scripts/Player目录下的detection脚本用于判断摧毁物体或放置物体的位置。
通过射线进行坐标检测，通过法线方向对坐标进行修正。

####镜头设置部分####

*在/Assets/Camera Scripts目录下的CameraSetting脚本设置了关于第三人称视角转动与跟随角色的部分。
还使用射线检测，在动态调整镜头与角色的距离，防止镜头穿到物体内部导致引发错误。

*在/Assets/Camera Scripts目录下的cameraSwitch脚本用于控制一三人称镜头切换以及聊天系统的打开与关闭。

####聊天系统部分####

*/Assets/ChatRoom目录下的ControlChatRoom脚本通过接受输入框输入的内容，进行内容判断，来实现指令的相关操作。
由于是测试项目，并没有做防范SQL注入的相关措施。如果用在正式场合，这部分应该要注意防范SQL注入攻击。


####UI部分####

*/Assets/UI/Scripts目录下的Select脚本定义了选中工具栏的方法，现在是有鼠标滑轮与输入数字两种方式。





***********

## 6、工程目录结构说明 ##

*3rd目录：存放第三方资源：第一人称视角预制件、LibNoise、UniStrom、DCG Water Shaders、Camera Filter Pack

*CaremaScripts目录：存放视角切换和第三人称视角

*Map目录：存放地图生成相关文件：地形贴图、地形材质、相关代码脚本等

*ChatRoom目录：存放与聊天系统相关的文件：聊天系统脚本

*UI目录：存放游戏界面UI相关文件：UI贴图、相关代码脚本等

***********
## 7、技术方案简介 ##

*地图不采用cube进行绘制，而是编写了Chunk类，在看不到的地方不进行渲染从而降低了CPU和GPU的负担。

*使用LibNoise加强地图复杂性。

*还做了界面UI和一三人称视角切换以及第三视角镜头。

*通过随机数生成不同的物体分布，通过脚本控制水上与水下不同的地形生成。

*将方块的序列存放起来，通改变方块在序列中的物体编号再绘制一次Chunk来达到破坏与创建方块的效果。

*使用UniStrom制作了项目的昼夜与天气系统。

*使用DCG Water Shaders制作水面，使用了Camera Filter Pack滤镜组构建水下滤镜。

*通过脚本判断角色是否处于水下，在角色处于水下时修改角色的重力等物理逻辑以及镜头滤镜。

*制作了聊天系统，使用聊天系统可以输入特定指令完成传送与改变天气等相关的操作。

